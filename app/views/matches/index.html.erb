<% content_for :head do %>
  <%= stylesheet_link_tag "matches_index", "data-turbo-track": "reload" %>
<% end %>

<div class="list-container">
  <div class="card">
    <div class="card-content">
      <div class="card-title">
        <i class="material-icons">emoji_events</i>
        試合記録
      </div>

      <!-- 試合を追加リンク -->
      <div class="add-match-link-container">
        <%= link_to new_match_path, class: "add-match-link" do %>
          <i class="material-icons">add</i>
          試合を追加
        <% end %>
      </div>

      <% if @matches.any? %>
        <ul class="match-list">
          <% @matches.each do |match| %>
            <%= link_to edit_score_match_path(match), data: { turbo: false }, class: "match-item-link" do %>
              <li class="match-item">
                <div class="match-header">
                  <div class="match-header-left">
                    <span class="match-title"><%= match.title %></span>
                    <span class="match-type">
                      <%= match.individual? ? '個人戦' : '団体戦' %>
                    </span>
                  </div>
                  <span class="match-date">
                    <%= match.match_date.strftime('%Y年%-m月%-d日') %>
                  </span>
                </div>

                <% if match.team? && match.team_score %>
                  <div class="match-score-line">
                    <div class="team-name team-name-large left">
                      <%= match.team_score.my_team_name.presence || '未入力' %>
                    </div>
                    <div class="score-display">
                      <div class="score-box <%= match.team_score.win? ? 'winner' : 'loser' %>">
                        <div class="score-fraction">
                          <div class="score-numerator"><%= match.team_score.my_total_points %></div>
                          <div class="score-line"></div>
                          <div class="score-denominator"><%= match.team_score.my_win_count %></div>
                        </div>
                      </div>
                      <span class="score-separator">-</span>
                      <div class="score-box <%= match.team_score.lose? ? 'winner' : 'loser' %>">
                        <div class="score-fraction">
                          <div class="score-numerator"><%= match.team_score.opponent_total_points %></div>
                          <div class="score-line"></div>
                          <div class="score-denominator"><%= match.team_score.opponent_win_count %></div>
                        </div>
                      </div>
                    </div>
                    <div class="team-name team-name-large right">
                      <%= match.team_score.opponent_team_name.presence || '未入力' %>
                    </div>
                  </div>
                <% elsif match.individual? && match.individual_score %>                 
                  <div class="match-score-line">
                    <div class="team-name player-name-large left">
                      <span class="player-team-name"><%= match.individual_score.my_team_name.presence || '未入力' %></span>
                      <span class="player-main-name"><%= match.individual_score.my_name.presence || '未入力' %></span>
                    </div>
                    
                    <div class="score-display">
                      <div class="score-box <%= match.individual_score.win? ? 'winner' : 'loser' %>">
                        <div class="score-fraction">
                          <div class="score-numerator"><%= match.individual_score.my_point_count %></div>
                          <div class="score-line"></div>
                          <div class="score-denominator"><%= match.individual_score.win? ? 1 : 0 %></div>
                        </div>
                      </div>
                      
                      <span class="score-separator">-</span>
                      
                      <div class="score-box <%= match.individual_score.lose? ? 'winner' : 'loser' %>">
                        <div class="score-fraction">
                          <div class="score-numerator"><%= match.individual_score.opponent_point_count %></div>
                          <div class="score-line"></div>
                          <div class="score-denominator"><%= match.individual_score.lose? ? 1 : 0 %></div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="team-name player-name-large right">
                      <span class="player-team-name"><%= match.individual_score.opponent_team_name.presence || '未入力' %></span>
                      <span class="player-main-name"><%= match.individual_score.opponent_name.presence || '未入力' %></span>
                    </div>
                  </div>
                <% end %>
              </li>
            <% end %>
          <% end %>
        </ul>
      <% else %>
        <p class="empty-message">まだ試合記録がありません</p>
      <% end %>
    </div>
  </div>
</div>